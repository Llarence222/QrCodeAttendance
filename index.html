<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Attendance QR Generator & Form</title>
  <script src="https://cdn.jsdelivr.net/npm/qrcode/build/qrcode.min.js"></script>
  <style>
    body { font-family: Arial, sans-serif; padding: 30px; max-width: 500px; margin: auto; }
    label, select, input, button { display: block; margin: 10px 0; width: 100%; padding: 8px; font-size: 16px; }
    #nameSection, #qrSection, #formSection { margin-top: 20px; }
    #qrCanvas { margin: auto; display: block; }
    #formSection { display: none; }
  </style>
</head>
<body>

  <h2>Attendance QR Generator</h2>

  <label for="attendanceType">Select Attendance Type:</label>
  <select id="attendanceType" onchange="onTypeChange()">
    <option value="">-- Select --</option>
    <option value="Student Attendance">Student Attendance</option>
    <option value="Event Attendance">Event Attendance</option>
  </select>

  <div id="nameSection" style="display:none;">
    <label for="nameInput">Insert your name:</label>
    <input type="text" id="nameInput" placeholder="Enter your name" oninput="generateQR()" />
  </div>

  <div id="qrSection" style="display:none;">
    <h3>Generated QR Code</h3>
    <canvas id="qrCanvas"></canvas>
    <p>Scan this QR code or click the button below to continue attendance</p>
    <button onclick="showFormFromQR()">Simulate Scan & Fill Form</button>
  </div>

  <div id="formSection">
    <h2>Complete Attendance Form</h2>
    <p><strong>Attendance Type:</strong> <span id="formType"></span></p>
    <p><strong>Name:</strong> <span id="formName"></span></p>

    <form id="attendanceForm">
      <label for="courseInput">Course:</label>
      <input type="text" id="courseInput" placeholder="Enter your course" required />

      <label for="yearSelect">Year:</label>
      <select id="yearSelect" required>
        <option value="">Select Year Level</option>
        <option value="1st Year">1st Year</option>
        <option value="2nd Year">2nd Year</option>
        <option value="3rd Year">3rd Year</option>
        <option value="4th Year">4th Year</option>
      </select>

      <label for="idInput">ID Number:</label>
      <input type="text" id="idInput" placeholder="Enter your ID number" required />

      <button type="submit">Submit Attendance</button>
    </form>
  </div>

  <script>
    function onTypeChange() {
      const type = document.getElementById('attendanceType').value;
      document.getElementById('nameSection').style.display = type ? 'block' : 'none';
      document.getElementById('qrSection').style.display = 'none';
      document.getElementById('formSection').style.display = 'none';
      document.getElementById('nameInput').value = '';
    }

    function generateQR() {
      const name = document.getElementById('nameInput').value.trim();
      const type = document.getElementById('attendanceType').value;
      const canvas = document.getElementById('qrCanvas');

      if(name && type) {
        // For simulation, encode the attendance info in JSON string
        const qrData = JSON.stringify({ type, name });
        QRCode.toCanvas(canvas, qrData, { width: 200 }, (error) => {
          if(error) console.error(error);
          else document.getElementById('qrSection').style.display = 'block';
          document.getElementById('formSection').style.display = 'none';
        });
      } else {
        document.getElementById('qrSection').style.display = 'none';
        document.getElementById('formSection').style.display = 'none';
      }
    }

    // This simulates scanning the QR code and extracting the info
    function showFormFromQR() {
      const canvas = document.getElementById('qrCanvas');
      // We have the data encoded in qrData from generateQR - but we can't read the canvas content directly
      // So let's just take the current inputs for demo purposes
      const type = document.getElementById('attendanceType').value;
      const name = document.getElementById('nameInput').value.trim();

      if(!type || !name) {
        alert('Please select attendance type and enter your name first.');
        return;
      }

      document.getElementById('formType').textContent = type;
      document.getElementById('formName').textContent = name;

      document.getElementById('formSection').style.display = 'block';
      window.scrollTo(0, document.body.scrollHeight);
    }

    // Handle form submit
    document.getElementById('attendanceForm').addEventListener('submit', function(e) {
      e.preventDefault();

      const type = document.getElementById('formType').textContent;
      const name = document.getElementById('formName').textContent;
      const course = document.getElementById('courseInput').value.trim();
      const year = document.getElementById('yearSelect').value;
      const idNumber = document.getElementById('idInput').value.trim();

      if(!course || !year || !idNumber) {
        alert('Please fill all the fields.');
        return;
      }

      alert(`âœ… Attendance Submitted!
Attendance Type: ${type}
Name: ${name}
Course: ${course}
Year: ${year}
ID Number: ${idNumber}`);

      // Reset everything
      document.getElementById('attendanceForm').reset();
      document.getElementById('formSection').style.display = 'none';
      document.getElementById('qrSection').style.display = 'none';
      document.getElementById('nameInput').value = '';
      document.getElementById('attendanceType').value = '';
      document.getElementById('nameSection').style.display = 'none';
    });
  </script>

</body>
</html>
